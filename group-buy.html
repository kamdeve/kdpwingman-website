<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDP Wingman - Przenieś swoje KDP na wyższy poziom</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script> 
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>

    <header>
        <nav class="container">
            <a href="#" class="logo">
                <img src="images/logo.svg" alt="KDP Wingman Icon">
                <span>KDP <span class="logo-wingman">Wingman</span></span>
            </a>
            <ul>
                <li><a href="#features">Funkcje</a></li>
                <li><a href="#register">Rejestracja</a></li>
                <li><a href="https://chrome.google.com/webstore/detail/kdp-wingman/nfjbklpfpcgfeeapkakgcekdkepbjgcm" class="nav-cta" target="_blank" rel="noopener noreferrer">Pobierz Rozszerzenie</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <main class="py-20 bg-gray-900 min-h-screen text-white">
        <div class="container mx-auto px-4 text-center">
            
            <h1 class="text-4xl font-bold mb-4 text-blue-400">Wspólny Dostęp Premium</h1>
            <p class="text-gray-300 mb-10 text-lg">Dołącz do grupy i płać ułamek ceny. Koszt całkowity (80$) jest dzielony na wszystkich uczestników.</p>

            <div class="max-w-2xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                <div class="bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-700">
                    <p class="text-sm text-gray-400 uppercase tracking-widest mb-2">Zgłoszonych osób</p>
                    <div id="userCount" class="text-6xl font-bold text-white">0</div>
                    <p class="text-xs text-gray-500 mt-2">w tym miesiącu</p>
                </div>
                
                <div class="bg-gray-800 p-8 rounded-2xl shadow-lg border-2 border-green-500/30 relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-green-500 text-black text-xs font-bold px-2 py-1 rounded-bl-lg">TERAZ</div>
                    <p class="text-sm text-gray-400 uppercase tracking-widest mb-2">Szacowana cena / os.</p>
                    <div id="pricePerPerson" class="text-6xl font-bold text-green-400">80.00 $</div>
                    <p class="text-xs text-gray-500 mt-2">im więcej nas, tym taniej!</p>
                </div>
            </div>

            <div class="max-w-2xl mx-auto mb-10 p-6 bg-blue-900/20 border border-blue-500/30 rounded-xl text-blue-200">
                <p class="mb-2"><i class="fas fa-hourglass-half mr-2"></i> Zapisy trwają do <strong>20-go dnia miesiąca</strong>.</p>
                <p><i class="fas fa-envelope mr-2"></i> Dostęp (login/hasło) zostanie wysłany na maila <strong>5-go dnia kolejnego miesiąca</strong>.</p>
            </div>

            <div class="max-w-md mx-auto bg-gray-800 p-8 rounded-2xl border border-gray-700">
                <form id="signupForm" class="flex flex-col gap-4">
                    <label class="text-left text-gray-400 text-sm ml-1">Twój adres e-mail</label>
                    <input type="email" id="emailInput" required placeholder="np. jan@kowalski.com" 
                        class="w-full p-4 rounded-lg bg-gray-900 border border-gray-600 text-white focus:border-blue-500 focus:outline-none transition">
                    
                    <button type="submit" 
                        class="w-full py-4 rounded-lg bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 font-bold text-white text-lg shadow-lg transform transition hover:-translate-y-1">
                        Dołącz do listy
                    </button>
                </form>
                <p id="message" class="mt-4 text-sm hidden"></p>
            </div>
        </div>
    </main>

    <script>
        // ADRES TWOJEGO BACKENDU (Ważne!)
        const API_URL = "http://localhost:3000"; 

        const userCountElement = document.getElementById('userCount');
        const priceElement = document.getElementById('pricePerPerson');
        const form = document.getElementById('signupForm');
        const message = document.getElementById('message');
        const btn = form.querySelector('button');

        // Funkcja pobierająca dane z serwera
        async function fetchStatus() {
            try {
                const res = await fetch(`${API_URL}/api/group-buy/status`);
                const data = await res.json();
                
                userCountElement.innerText = data.users;
                priceElement.innerText = data.price + " $";
            } catch (error) {
                console.error("Nie udało się połączyć z serwerem.", error);
                priceElement.innerText = "---";
            }
        }

        // Wysyłanie zgłoszenia
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('emailInput').value;
            
            btn.disabled = true;
            btn.innerText = "Zapisywanie...";
            message.classList.add('hidden');

            try {
                const res = await fetch(`${API_URL}/api/group-buy/join`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email })
                });

                const result = await res.json();

                if (res.ok) {
                    message.innerText = "✅ " + result.message;
                    message.className = "mt-4 text-sm text-green-400 font-bold";
                    form.reset();
                    fetchStatus(); // Odśwież licznik
                } else {
                    message.innerText = "❌ " + result.message;
                    message.className = "mt-4 text-sm text-red-400 font-bold";
                }
            } catch (error) {
                message.innerText = "❌ Błąd połączenia z serwerem. Upewnij się, że backend działa.";
                message.className = "mt-4 text-sm text-red-400";
            } finally {
                message.classList.remove('hidden');
                btn.disabled = false;
                btn.innerText = "Dołącz do listy";
            }
        });

        // Start
        fetchStatus();
    </script>
    </main>

    <footer>
        <div class="container">
            <p>
                &copy; 2025 KDP Wingman. Wszelkie prawa zastrzeżone. | 
                <a href="privacy.html" style="color: white; text-decoration: underline;">Polityka Prywatności</a>
            </p>
        </div>
    </footer>

    <script>
        const registerForm = document.querySelector('.register-form');
    
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault(); 
    
            const email = registerForm.querySelector('input[type="email"]').value;
            const password = registerForm.querySelector('input[type="password"]').value;
            const passwordConfirm = registerForm.querySelectorAll('input[type="password"]')[1].value;
    
            if (password !== passwordConfirm) {
                alert('Błąd: Hasła nie są takie same!');
                return;
            }
    
            try {
                const response = await fetch('https://kdpwingman-backend-production.up.railway.app/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password }),
                });
    
                const data = await response.json();
    
                if (!response.ok) {
                    throw new Error(data.message || 'Wystąpił nieznany błąd.');
                }
    
                alert('Konto utworzone! Sprawdź skrzynkę e-mail i kliknij link aktywacyjny, aby dokończyć rejestrację.');
                registerForm.reset(); 
    
            } catch (error) {
                console.error('Błąd rejestracji:', error);
                alert(`Błąd: ${error.message}`);
            }
        });
    </script>

</body>
</html>
